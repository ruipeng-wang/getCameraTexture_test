"use strict";var t=require("./emw.js");var e=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)};function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}for(var r=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"image/jpeg"};n(this,t),this.parts=e,this.options=r,r.type=r.type.replace("jpg","jpeg")},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256),s=0;s<o.length;s++)i[o.charCodeAt(s)]=s;function a(t){var e,n,r,o,s,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var l=new ArrayBuffer(a),h=new Uint8Array(l);for(e=0;e<c;e+=4)n=i[t.charCodeAt(e)],r=i[t.charCodeAt(e+1)],o=i[t.charCodeAt(e+2)],s=i[t.charCodeAt(e+3)],h[u++]=n<<2|r>>4,h[u++]=(15&r)<<4|o>>2,h[u++]=(3&o)<<6|63&s;return l}var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e=t.prototype;return e.createObjectURL=function(t){if(n=t,null!=(i=r)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](n):n instanceof i){var e=function(t){for(var e,n="",r=new Uint8Array(t),i=r.byteLength,s=i%3,a=i-s,c=0;c<a;c+=3)e=r[c]<<16|r[c+1]<<8|r[c+2],n+=o[(16515072&e)>>18]+o[(258048&e)>>12]+o[(4032&e)>>6]+o[63&e];return 1==s?(e=r[a],n+=o[(252&e)>>2]+o[(3&e)<<4]+"=="):2==s&&(e=r[a]<<8|r[a+1],n+=o[(64512&e)>>10]+o[(1008&e)>>4]+o[(15&e)<<2]+"="),n}(t.parts[0]);return"data:".concat(t.options.type,";base64,").concat(e)}var n,i;return""},e.revokeObjectURL=function(){},t}();function u(t){if((t=(t="".concat(t)).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(t=t.replace(/==?$/,"")),t.length%4==1||/[^+/0-9A-Za-z]/.test(t))return"";for(var e,n,r="",o=0,i=0,s=0;s<t.length;s++)o<<=6,o|=(e=t[s],n=void 0,(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e))<0?void 0:n),24===(i+=6)&&(r+=String.fromCharCode((16711680&o)>>16),r+=String.fromCharCode((65280&o)>>8),r+=String.fromCharCode(255&o),o=i=0);return 12===i?(o>>=4,r+=String.fromCharCode(o)):18===i&&(o>>=2,r+=String.fromCharCode((65280&o)>>8),r+=String.fromCharCode(255&o)),r}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var h=new WeakMap,p=function t(e){l(this,t),this.identifier=e.identifier,this.force=void 0===e.force?1:e.force,this.pageX=void 0===e.pageX?e.x:e.pageX,this.pageY=void 0===e.pageY?e.y:e.pageY,this.clientX=void 0===e.clientX?e.x:e.clientX,this.clientY=void 0===e.clientY?e.y:e.clientY,this.screenX=this.pageX,this.screenY=this.pageY},f=function(){function t(){l(this,t),h.set(this,{})}var e=t.prototype;return e.addEventListener=function(t,e){var n=h.get(this);n||(n={},h.set(this,n)),n[t]||(n[t]=[]),n[t].push(e)},e.removeEventListener=function(t,e){var n=h.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var o=r.length;o--;o>0)if(r[o]===e){r.splice(o,1);break}}},e.dispatchEvent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:""};"function"!=typeof t.preventDefault&&(t.preventDefault=function(){}),"function"!=typeof t.stopPropagation&&(t.stopPropagation=function(){});var e=h.get(this);if(e){var n=e[t.type];if(n)for(var r=0;r<n.length;r++)n[r](t)}"function"==typeof this["on".concat(t.type)]&&this["on".concat(t.type)].call(this,t)},e.releasePointerCapture=function(){},e.setPointerCapture=function(){},t}();function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,n){return g=y()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&b(o,n.prototype),o},g.apply(null,arguments)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function m(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?d(t):e}function b(t,e){return b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},b(t,e)}var w=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function O(t){var e="function"==typeof Map?new Map:void 0;return O=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return g(t,arguments,v(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),b(r,t)},O(t)}function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=v(t);if(e){var o=v(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _(this,n)}}var T=new WeakMap,R=new WeakMap,x=new WeakMap;function S(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.target=e.target||this,"function"==typeof this["on".concat(t)]&&this["on".concat(t)].call(this,e)}function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.readyState=t,e.readyState=t,S.call(this,"readystatechange",e)}function P(t){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(n,O(f));var e=E(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t.responseType="text",t.dataType="string",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,T.set(d(t),{"content-type":"application/x-www-form-urlencoded"}),R.set(d(t),{}),t}var r=n.prototype;return r.abort=function(){var t=x.get(this);t&&t.abort()},r.getAllResponseHeaders=function(){var t=R.get(this);return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")},r.getResponseHeader=function(t){return R.get(this)[t]},r.open=function(t,e){this._method=t,this._url=e,C.call(this,n.OPENED)},r.overrideMimeType=function(){},r.send=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;if(this.readyState!==n.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");var r,o=this._url,i=T.get(this),s=this.responseType,a=this.dataType,c=P(o);"arraybuffer"===s||(r="utf8"),delete this.response,this.response=null;var u=!1,l=function(t){var r=t.data,o=t.statusCode,i=t.header;if(!u){if(u=!0,o=void 0===o?200:o,"string"!=typeof r&&!m(r,ArrayBuffer))try{r=JSON.stringify(r)}catch(t){}e.status=o,i&&R.set(e,i),S.call(e,"loadstart"),C.call(e,n.HEADERS_RECEIVED),C.call(e,n.LOADING),e.response=r,m(r,ArrayBuffer)?Object.defineProperty(e,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):e.responseText=r,C.call(e,n.DONE),S.call(e,"load"),S.call(e,"loadend")}},h=function(t){var n=t.errMsg;u||(u=!0,-1!==n.indexOf("abort")?S.call(e,"abort"):S.call(e,"error",{message:n}),S.call(e,"loadend"),c&&console.warn(n))};if(c){var p=tt.getFileSystemManager(),f={filePath:o,success:l,fail:h};return r&&(f.encoding=r),void p.readFile(f)}tt.request({data:t,url:o,method:this._method,header:i,dataType:a,responseType:s,enableCache:!1,success:l,fail:h})},r.setRequestHeader=function(t,e){var n=T.get(this);n[t]=e,T.set(this,n)},r.addEventListener=function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})},r.removeEventListener=function(t,e){this["on"+t]===e&&(this["on"+t]=null)},n}();function M(t,e){var n=!0,r=!1,o=void 0;try{for(var i,s=Object.getOwnPropertyNames(e)[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var a=i.value;if("constructor"!==a&&"prototype"!==a&&"name"!==a){var c=Object.getOwnPropertyDescriptor(e,a);c&&Object.defineProperty(t,a,c)}}}catch(t){r=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}}function A(t){var e=t.createImage();return e.addEventListener=function(t,n){return e["on".concat(t)]=n.bind(e)},e.removeEventListener=function(t){return e["on".concat(t)]=null},e}function I(t){var e=function(){if(o(/^<\?xml\s*/)){for(var t={attributes:{},children:[]};!i()&&!s("?>");){var e=n();if(!e)return t;t.attributes[e.name]=e.value}return o(/\?>\s*/),o(/<!DOCTYPE[^>]*>\s/),t}},n=function(){var t=o(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(t)return{name:t[1],value:r(t[2])}},r=function(t){return t.replace(/^['"]|['"]$/g,"")},o=function(e){var n=t.match(e);if(n)return t=t.slice(n[0].length),n},i=function(){return 0==t.length},s=function(e){return 0==t.indexOf(e)};return t=(t=t.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:a(),isXML:!0};function a(){var t=o(/^<([\w-:.]+)\s*/);if(t){for(var e,r={name:t[1],attributes:{},children:[]};!(i()||s(">")||s("?>")||s("/>"));){var c=n();if(!c)return r;r.attributes[c.name]=c.value}if(o(/^\s*\/>\s*/))return r;for(o(/\??>\s*/),r.content=function(){var t=o(/^([^<]*)/);return t?t[1]:""}();e=a();)r.children.push(e);return o(/^<\/[\w-:.]+>\s*/),r}}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function L(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,e){e(t),t.children.forEach((function(t){return N(t,e)}))}D.UNSEND=0,D.OPENED=1,D.HEADERS_RECEIVED=2,D.LOADING=3,D.DONE=4;var F=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.prototype.parseFromString=function(t){var e=I(t),n={hasAttribute:function(t){return void 0!==this.attributes[t]},getAttribute:function(t){return this.attributes[t]},getElementsByTagName:function(t){var e=[];return this.childNodes.forEach((function(n){return N(n,(function(n){return t===n.name&&e.push(n)}))})),e}};e.root&&N(e.root,(function(t){t.nodeType=1,t.nodeName=t.name,t.style=new Proxy((t.attributes.style||"").split(";").reduce((function(t,e){if(e){var n=L(e.split(":"),2),r=n[0],o=n[1];t[r.trim()]=o.trim()}return t}),{}),{get:function(t,e){return t[e]||""}}),t.textContent=t.content,t.childNodes=t.children,t.__proto__=n}));var r={documentElement:e.root,childNodes:[e.root]};return r.__proto__=n,r},t}();var B=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return t.prototype.decode=function(t){for(var e,n,r=(e=t,(null!=(n=ArrayBuffer)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](e):e instanceof n)?new Uint8Array(t):t),o="",i=0,s=r.length;i<s;i++)o+=String.fromCharCode(r[i]);try{return decodeURIComponent(escape(o))}catch(t){return o}},t}(),q={now:function(){return Date.now()}};function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function U(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function X(t,e,n){return X=U()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&V(o,n.prototype),o},X.apply(null,arguments)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function W(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function Q(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?H(t):e}function V(t,e){return V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},V(t,e)}var z=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function G(t){var e="function"==typeof Map?new Map:void 0;return G=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return X(t,arguments,k(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),V(r,t)},G(t)}function Y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=k(t);if(e){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Q(this,n)}}var J=new WeakMap,$=new WeakMap,K=new WeakMap;function Z(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.target=e.target||this,"function"==typeof this["on".concat(t)]&&this["on".concat(t)].call(this,e)}function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.readyState=t,e.readyState=t,Z.call(this,"readystatechange",e)}function nt(t){return!/^(http|https|ftp|myfile):\/\/.*/i.test(t)}var rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(n,G(f));var e=Y(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t.responseType="text",t.dataType="arraybuffer",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,J.set(H(t),{"content-type":"application/x-www-form-urlencoded"}),$.set(H(t),{}),t}var r=n.prototype;return r.abort=function(){var t=K.get(this);t&&t.abort()},r.getAllResponseHeaders=function(){var t=$.get(this);return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")},r.getResponseHeader=function(t){return $.get(this)[t]},r.open=function(t,e){this._method=t,this._url=e,et.call(this,n.OPENED)},r.overrideMimeType=function(){},r.send=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;if(this.readyState!==n.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");var r=this._url,o=(J.get(this),this.responseType),i=(this.dataType,nt(r));delete this.response,this.response=null;var s=function(t){var r=t.data,i=t.statusCode,s=t.header;if("arraybuffer"===o&&(r=a(r)),i=void 0===i?200:i,"string"!=typeof r&&!W(r,ArrayBuffer))try{r=JSON.stringify(r)}catch(t){}e.status=i,s&&$.set(e,s),Z.call(e,"loadstart"),et.call(e,n.HEADERS_RECEIVED),et.call(e,n.LOADING),e.response=r,W(r,ArrayBuffer)?Object.defineProperty(e,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):e.responseText=r,et.call(e,n.DONE),Z.call(e,"load"),Z.call(e,"loadend")},c=function(t){var n=t.errorMessage;-1!==n.indexOf("abort")?Z.call(e,"abort"):Z.call(e,"error",{message:n}),Z.call(e,"loadend"),i&&console.warn(n)};if(i){var u=my.getFileSystemManager(),l={filePath:r,success:s,fail:c};return u.access({path:r,success:function(t){console.log("文件存在",t)},fail:function(t){console.log("err:",t)}}),void u.readFile(l)}var h=function(e){my.downloadFile({url:e,data:t,success:function(t){var e=t.apFilePath;my.getFileSystemManager().readFile({filePath:e,encoding:"arraybuffer"===o?"base64":"utf8",success:s})},fail:c})};n.URLModifier?Promise.resolve(n.URLModifier(r)).then(h):h(r)},r.setRequestHeader=function(t,e){var n=J.get(this);n[t]=e,J.set(this,n)},r.addEventListener=function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})},r.removeEventListener=function(t,e){this["on"+t]===e&&(this["on"+t]=null)},n}();rt.UNSEND=0,rt.OPENED=1,rt.HEADERS_RECEIVED=2,rt.LOADING=3,rt.DONE=4;Math.PI;function ot(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function it(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function st(t,e,n){return st=it()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&lt(o,n.prototype),o},st.apply(null,arguments)}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},at(t)}function ct(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function ut(t,e){return!e||"object"!==ht(e)&&"function"!=typeof e?ot(t):e}function lt(t,e){return lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lt(t,e)}var ht=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function pt(t){var e="function"==typeof Map?new Map:void 0;return pt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return st(t,arguments,at(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),lt(r,t)},pt(t)}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=at(t);if(e){var o=at(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ut(this,n)}}var dt=new WeakMap,yt=new WeakMap,gt=new WeakMap;function vt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.target=e.target||this,"function"==typeof this["on".concat(t)]&&this["on".concat(t)].call(this,e)}function mt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.readyState=t,e.readyState=t,vt.call(this,"readystatechange",e)}function _t(t){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(t)}var bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}(n,pt(f));var e=ft(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).runtime=wx.getSystemInfoSync().platform,t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t.responseType="text",t.dataType="string",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,dt.set(ot(t),{"content-type":"application/x-www-form-urlencoded"}),yt.set(ot(t),{}),t}var r=n.prototype;return r.abort=function(){var t=gt.get(this);t&&t.abort()},r.getAllResponseHeaders=function(){var t=yt.get(this);return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")},r.getResponseHeader=function(t){return yt.get(this)[t]},r.open=function(t,e){this._method=t,this._url=e,mt.call(this,n.OPENED)},r.overrideMimeType=function(){},r.send=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this;if(this.readyState!==n.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");var r,o=this._url,i=dt.get(this),s=this.responseType,a=this.dataType,c=_t(o);"arraybuffer"===s||(r="utf8"),"json"===s&&(a="json",s="text"),delete this.response,this.response=null;var u=!1,l=function(t){var r=t.data,o=t.statusCode,i=t.header;if(!u){if(u=!0,o=void 0===o?200:o,"string"!=typeof r&&!ct(r,ArrayBuffer)&&"json"!==a)try{r=JSON.stringify(r)}catch(t){}e.status=o,i&&yt.set(e,i),vt.call(e,"loadstart"),mt.call(e,n.HEADERS_RECEIVED),mt.call(e,n.LOADING),e.response=r,ct(r,ArrayBuffer)?Object.defineProperty(e,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):e.responseText=r,mt.call(e,n.DONE),vt.call(e,"load"),vt.call(e,"loadend")}},h=function(t){var n=t.errMsg;u||(u=!0,-1!==n.indexOf("abort")?vt.call(e,"abort"):vt.call(e,"error",{message:n}),vt.call(e,"loadend"),c&&console.warn(n))};if(c){var p=wx.getFileSystemManager(),f={filePath:o,success:l,fail:h};return r&&(f.encoding=r),void p.readFile(f)}var d="arraybuffer"===s&&"ios"===this.runtime&&n.useFetchPatch,y=wx.request({data:t,url:o,method:this._method.toUpperCase(),header:i,dataType:a,responseType:s,enableCache:!1,success:l,fail:h});y.onChunkReceived((function(t){console.log(t)})),d&&setTimeout((function(){wx.request({data:t,url:o,method:this._method,header:i,dataType:a,responseType:s,enableCache:!0,success:l,fail:h})}),n.fetchPatchDelay)},r.setRequestHeader=function(t,e){var n=dt.get(this);n[t]=e,dt.set(this,n)},r.addEventListener=function(t,e){var n=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})},r.removeEventListener=function(t,e){this["on"+t]===e&&(this["on"+t]=null)},n}();function wt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}function Et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){wt(t,e,n[e])}))}return t}function Tt(t,e){return!e||"object"!==xt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Rt(t,e){return Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Rt(t,e)}bt.UNSEND=0,bt.OPENED=1,bt.HEADERS_RECEIVED=2,bt.LOADING=3,bt.DONE=4,bt.useFetchPatch=!1,bt.fetchPatchDelay=200;var xt=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ot(t);if(e){var o=Ot(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Tt(this,n)}}function Ct(){return wx.createOffscreenCanvas()}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rt(t,e)}(n,t);var e=St(n);function n(t,o,i){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(s=e.call(this)).enabledDeviceMotion=!1,s.canvasRect={width:0,height:0,top:0,left:0,right:0,bottom:0};var a=wx.getSystemInfoSync(),l="android"===a.platform;s.canvas=t,s.canvasW=void 0===o?t.width:o,s.canvasH=void 0===i?t.height:i,s.canvasRect.width=s.canvasW,s.canvasRect.height=s.canvasH;var h={createElementNS:function(e,n){return"canvas"===n?t:"img"===n?A(t):void 0},createElement:function(e){return"canvas"===e?t:"img"===e?A(t):void 0},body:{}},p=A(t),d=function(){return A(t)},y=new c,g={innerWidth:a.windowWidth,innerHeight:a.windowHeight,devicePixelRatio:a.pixelRatio,AudioContext:function(){},requestAnimationFrame:s.canvas.requestAnimationFrame,cancelAnimationFrame:s.canvas.cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:function(){return Promise.resolve("granted")}},URL:y,Image:d,DOMParser:F,TextDecoder:B,Blob:r,performance:q};return[t,h,g,h.body].forEach((function(t){var e=t.__proto__;t.__proto__={},t.__proto__.__proto__=e,M(t.__proto__,f.prototype)})),s.polyfill={window:g,document:h,Blob:r,DOMParser:F,TextDecoder:B,XMLHttpRequest:bt,OffscreenCanvas:Ct,URL:y,Image:d,HTMLImageElement:p.constructor,atob:u,global:g,createImageBitmap:void 0,cancelAnimationFrame:g.cancelAnimationFrame,requestAnimationFrame:g.requestAnimationFrame,performance:g.performance},s.patchCanvas(),s.onDeviceMotionChange=function(t){t.type="deviceorientation",l&&(t.alpha*=-1,t.beta*=-1,t.gamma*=-1),g.dispatchEvent(t)},s}var o=n.prototype;return o.patchCanvas=function(){var t=this,e=this,n=e.canvasH,r=e.canvasW,o=e.canvas;Object.defineProperty(this.canvas,"style",{get:function(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(this.canvas,"clientHeight",{get:function(){return n||this.height}}),Object.defineProperty(this.canvas,"clientWidth",{get:function(){return r||this.width}}),o.ownerDocument=this.document,o.getBoundingClientRect=function(){return t.canvasRect},o._getContext=this.canvas.getContext,o.getContext=function(){var t;return"webgl"!==arguments[0]?null:(t=o)._getContext.apply(t,arguments)}},o.patchXHR=function(){return bt.useFetchPatch=!0,this},o.enableDeviceOrientation=function(t){var e=this;return new Promise((function(n,r){wx.onDeviceMotionChange(e.onDeviceMotionChange),wx.startDeviceMotionListening({interval:t,success:function(t){n(t),e.enabledDeviceMotion=!0},fail:r})}))},o.disableDeviceOrientation=function(){var t=this;return new Promise((function(e,n){wx.offDeviceMotionChange(t.onDeviceMotionChange),t.enabledDeviceMotion&&wx.stopDeviceMotionListening({success:function(){e(!0),t.enabledDeviceMotion=!1},fail:n})}))},o.dispatchTouchEvent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{touches:[],changedTouches:[],timeStamp:0,type:""},e=Et({},this),n=t.changedTouches.map((function(t){return new p(t)})),r={changedTouches:n,touches:t.touches.map((function(t){return new p(t)})),targetTouches:Array.prototype.slice.call(t.touches.map((function(t){return new p(t)}))),timeStamp:t.timeStamp,target:e,currentTarget:e,type:t.type,cancelBubble:!1,cancelable:!1};if(this.canvas.dispatchEvent(r),n.length){var o=n[0],i={pageX:o.pageX,pageY:o.pageY,offsetX:o.pageX,offsetY:o.pageY,pointerId:o.identifier,type:{touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup"}[t.type]||"",pointerType:"touch"};this.canvas.dispatchEvent(i)}},o.dispose=function(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.canvas=null},n}(e);function Dt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Mt(t){return Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mt(t)}function At(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Dt(t,e,n[e])}))}return t}function It(t,e){return!e||"object"!==Lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jt(t,e){return jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},jt(t,e)}var Lt=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mt(t);if(e){var o=Mt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return It(this,n)}}var Ft=wx;function Bt(){return Ft.createOffscreenCanvas()}var qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}(n,t);var e=Nt(n);function n(t,o,i){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(s=e.call(this)).enabledDeviceMotion=!1,s.canvasRect={width:0,height:0,top:0,left:0,right:0,bottom:0};var a=Ft.getSystemInfoSync(),l="android"===a.platform;s.canvas=t,s.canvasW=void 0===o?t.width:o,s.canvasH=void 0===i?t.height:i,s.canvasRect.width=s.canvasW,s.canvasRect.height=s.canvasH;var h={createElementNS:function(e,n){return"canvas"===n?t:"img"===n?A(Ft):void 0},createElement:function(e){return"canvas"===e?t:"img"===e?A(Ft):void 0}},p=function(){return A(Ft)},d=new c,y={innerWidth:a.windowWidth,innerHeight:a.windowHeight,devicePixelRatio:a.pixelRatio,AudioContext:function(){},requestAnimationFrame:requestAnimationFrame,cancelAnimationFrame:cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:function(){return Promise.resolve("granted")}},URL:d,Image:p,DOMParser:F,TextDecoder:B,performance:Date};[t,h,y].forEach((function(t){var e=t.__proto__;t.__proto__={},t.__proto__.__proto__=e,M(t.__proto__,f.prototype)})),s.polyfill={window:y,document:h,Blob:r,DOMParser:F,TextDecoder:B,XMLHttpRequest:bt,OffscreenCanvas:Bt,URL:d,Image:p,performance:Date,atob:u,global:y,createImageBitmap:void 0,cancelAnimationFrame:y.cancelAnimationFrame,requestAnimationFrame:y.requestAnimationFrame},s.patchCanvas(),s.onDeviceMotionChange=function(t){t.type="deviceorientation",l&&(t.alpha*=-1,t.beta*=-1,t.gamma*=-1),y.dispatchEvent(t)};var g=function(t){return s.dispatchTouchEvent(t)};return("devtools"!=a.platform||n.DEVTOOLS_USE_NATIVE_EVENT)&&(Ft.onTouchMove(g),Ft.onTouchStart(g),Ft.onTouchEnd(g)),s}var o=n.prototype;return o.patchCanvas=function(){var t=this,e=this,n=e.canvasH,r=e.canvasW,o=e.canvas;Object.defineProperty(o,"style",{get:function(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(o,"clientHeight",{get:function(){return n||this.height}}),Object.defineProperty(o,"clientWidth",{get:function(){return r||this.width}}),o.getBoundingClientRect=function(){return t.canvasRect}},o.patchXHR=function(){return bt.useFetchPatch=!0,this},o.enableDeviceOrientation=function(t){var e=this;return new Promise((function(n,r){Ft.onDeviceMotionChange(e.onDeviceMotionChange),Ft.startDeviceMotionListening({interval:t,success:function(t){n(t),e.enabledDeviceMotion=!0},fail:r})}))},o.disableDeviceOrientation=function(){var t=this;return new Promise((function(e,n){Ft.offDeviceMotionChange(t.onDeviceMotionChange),t.enabledDeviceMotion&&Ft.stopDeviceMotionListening({success:function(){e(!0),t.enabledDeviceMotion=!1},fail:n})}))},o.dispatchTouchEvent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{touches:[],changedTouches:[],timeStamp:0,type:""},e=At({},this),n=t.changedTouches.map((function(t){return new p(t)})),r={changedTouches:n,touches:t.touches.map((function(t){return new p(t)})),targetTouches:Array.prototype.slice.call(t.touches.map((function(t){return new p(t)}))),timeStamp:t.timeStamp,target:e,currentTarget:e,type:t.type,cancelBubble:!1,cancelable:!1};if(this.canvas.dispatchEvent(r),n.length){var o=n[0],i={pageX:o.pageX,pageY:o.pageY,offsetX:o.pageX,offsetY:o.pageY,pointerId:o.identifier,type:{touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup"}[t.type]||"",pointerType:"touch"};this.canvas.dispatchEvent(i)}},o.dispose=function(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.canvas=null},n}(e);qt.DEVTOOLS_USE_NATIVE_EVENT=!0;function Ht(t){return Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ht(t)}function Ut(t,e){return!e||"object"!==kt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Xt(t,e){return Xt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xt(t,e)}var kt=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ht(t);if(e){var o=Ht(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ut(this,n)}}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xt(t,e)}(n,Pt);var e=Wt(n);function n(t,r,o){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,t,r,o)).polyfill.$defaultWebGLExtensions={},i.polyfill.document.createElement=function(e){return"canvas"===e?t:"img"===e?t.createImage():void 0},i.polyfill.document.body=t,i.polyfill.document.head={},i.polyfill.fetch=function(t,e){return new Promise((function(n,r){wx.request({url:t,responseType:e.responseType,success:function(t){t.status=t.statusCode,t.headers={get:function(e){var n=Object.keys(t.header),r=new RegExp(e,"ig"),o=n.find((function(t){return r.test(t)}));return o?t.header[o]:""}},t.arrayBuffer=function(){return t.data},t.json=function(){return t.data},n(t)},fail:function(t){r(t)}})}))},t.appendChild=function(){},t.setAttribute=function(){},i}return n}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var Vt,zt,Gt=(Vt=function(t,e){var n=function(){if(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),"object"!=typeof WXWebAssembly)return{supported:!1};var t,e=WXWebAssembly.instantiate("/pages/ar-page/meshopt_decoder.wasm",{}).then((function(e){(t=e.instance).exports.__wasm_call_ctors()}));function n(e,n,r,o,i,s){var a=t.exports.sbrk,c=r+3&-4,u=a(c*o),l=a(i.length),h=new Uint8Array(t.exports.memory.buffer);h.set(i,l);var p=e(u,r,o,l,i.length);if(0==p&&s&&s(u,c,o),n.set(h.subarray(u,u+r*o)),a(u-a(0)),0!=p)throw new Error("Malformed buffer data: "+p)}var r={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:e,supported:!0,decodeVertexBuffer:function(e,o,i,s,a){n(t.exports.meshopt_decodeVertexBuffer,e,o,i,s,t.exports[r[a]])},decodeIndexBuffer:function(e,r,o,i){n(t.exports.meshopt_decodeIndexBuffer,e,r,o,i)},decodeIndexSequence:function(e,r,o,i){n(t.exports.meshopt_decodeIndexSequence,e,r,o,i)},decodeGltfBuffer:function(e,i,s,a,c,u){n(t.exports[o[c]],e,i,s,a,t.exports[r[u]])}}}();t.exports=n},Vt(zt={exports:{}},zt.exports),zt.exports);class Yt{get(t,e,n){return"function"==typeof e&&(n=e,e={}),this.request("GET",t,e,n)}head(t,e,n){return"function"==typeof e&&(n=e,e={}),this.request("HEAD",t,e,n)}post(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n.postdata=e,this.request("POST",t,n,r)}put(t,e,n,r){return"function"==typeof n&&(r=n,n={}),n.postdata=e,this.request("PUT",t,n,r)}del(t,e,n){return"function"==typeof e&&(n=e,e={}),this.request("DELETE",t,e,n)}request(e,n,r,o){var i,s,a,c,u,l=!1;if("function"==typeof r&&(o=r,r={}),r.retry&&(r=Object.assign({retries:0,maxRetries:5},r)),r.callback=o,null==r.async&&(r.async=!0),null==r.headers&&(r.headers={}),null!=r.postdata)if(r.postdata instanceof Document)c=r.postdata;else if(r.postdata instanceof FormData)c=r.postdata;else if(r.postdata instanceof Object){var h=r.headers["Content-Type"];switch(void 0===h&&(r.headers["Content-Type"]=Yt.ContentType.FORM_URLENCODED,h=r.headers["Content-Type"]),h){case Yt.ContentType.FORM_URLENCODED:c="";var p=!0;for(var f in r.postdata)r.postdata.hasOwnProperty(f)&&(p?p=!1:c+="&",c+=escape(f)+"="+escape(r.postdata[f]));break;default:case Yt.ContentType.JSON:null==h&&(r.headers["Content-Type"]=Yt.ContentType.JSON),c=JSON.stringify(r.postdata)}}else c=r.postdata;for(var d in!1===r.cache&&(a=t.now(),(i=new t.URI(n)).query?i.query=i.query+"&ts="+a:i.query="ts="+a,n=i.toString()),r.query&&(i=new t.URI(n),s=t.extend(i.getQuery(),r.query),i.setQuery(s),n=i.toString()),(u=new t.PlatformManager.polyfill.XMLHttpRequest).open(e,n,r.async),u.withCredentials=void 0!==r.withCredentials&&r.withCredentials,u.responseType=r.responseType||this._guessResponseType(n),r.headers)r.headers.hasOwnProperty(d)&&u.setRequestHeader(d,r.headers[d]);u.onreadystatechange=function(){this._onReadyStateChange(e,n,r,u),r.onreadystatechange&&r.onreadystatechange(e,n,r,u)}.bind(this),u.onprogress=function(t){r.onprogress&&r.onprogress(t,u)},u.onerror=function(){this._onError(e,n,r,u),l=!0}.bind(this);try{u.send(c)}catch(t){l||r.error(u.status,u,t)}return u}_guessResponseType(e){var n=new t.URI(e),r=t.path.getExtension(n.path);return Yt.binaryExtensions.indexOf(r)>=0?Yt.ResponseType.ARRAY_BUFFER:".xml"===r?Yt.ResponseType.DOCUMENT:Yt.ResponseType.TEXT}_isBinaryContentType(t){return[Yt.ContentType.MP4,Yt.ContentType.WAV,Yt.ContentType.OGG,Yt.ContentType.MP3,Yt.ContentType.BIN,Yt.ContentType.DDS,Yt.ContentType.BASIS,Yt.ContentType.GLB].indexOf(t)>=0}_onReadyStateChange(t,e,n,r){if(4===r.readyState)switch(r.status){case 0:r.responseURL&&r.responseURL.startsWith("file:///")?this._onSuccess(t,e,n,r):this._onError(t,e,n,r);break;case 200:case 201:case 206:case 304:this._onSuccess(t,e,n,r);break;default:this._onError(t,e,n,r)}}_onSuccess(t,e,n,r){var o,i,s;(i=r.getResponseHeader("Content-Type"))&&(s=i.split(";")[0].trim());try{console.log("http start",e),s===this.ContentType.JSON||e.split("?")[0].endsWith(".json")?o=JSON.parse(r.responseText):this._isBinaryContentType(s)?o=r.response:(s&&console.warn("responseType: "+r.responseType+" being served with Content-Type: "+s),o=r.responseType===Yt.ResponseType.ARRAY_BUFFER||r.responseType===Yt.ResponseType.BLOB||r.responseType===Yt.ResponseType.JSON?r.response:r.responseType===Yt.ResponseType.DOCUMENT||s===this.ContentType.XML?r.responseXML:r.responseText),n.callback(null,o)}catch(t){console.log("error",t),n.callback(t)}}_onError(e,n,r,o){if(!r.retrying)if(r.retry&&r.retries<r.maxRetries){r.retries++,r.retrying=!0;var i=t.math.clamp(Math.pow(2,r.retries)*Yt.retryDelay,0,r.maxRetryDelay||5e3);console.log(e+": "+n+" - Error "+o.status+". Retrying in "+i+" ms"),setTimeout(function(){r.retrying=!1,this.request(e,n,r,r.callback)}.bind(this),i)}else r.callback(0===o.status?"Network error":o.status,null)}}Yt.ContentType={FORM_URLENCODED:"application/x-www-form-urlencoded",GIF:"image/gif",JPEG:"image/jpeg",DDS:"image/vnd.ms-dds",JSON:"application/json",PNG:"image/png",KTX:"image/ktx",KTX2:"image/ktx2",TEXT:"text/plain",XML:"application/xml",WAV:"audio/x-wav",OGG:"audio/ogg",MP3:"audio/mpeg",MP4:"audio/mp4",AAC:"audio/aac",BIN:"application/octet-stream",BASIS:"image/basis",GLB:"model/gltf-binary",SCRIPT:"application/javascript"},Yt.ResponseType={TEXT:"text",ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json"},Yt.binaryExtensions=[".model",".wav",".ogg",".mp3",".mp4",".m4a",".aac",".dds",".basis",".glb",".hdr"],Yt.retryDelay=100,Object.freeze(Yt.ContentType),Object.freeze(Yt.ResponseType),Object.freeze(Yt.binaryExtensions),Object.assign(Yt.prototype,{ContentType:Yt.ContentType,ResponseType:Yt.ResponseType,binaryExtensions:Yt.binaryExtensions});const Jt=new Yt;class $t{constructor(e,n,r){t.events.attach(this),this.manager=n,r&&(this.container=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=e,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new t.Quat,this._toQuat=new t.Quat,this._quat=new t.Quat,this._scale=!1,this._fromScale=new t.Vec3,this._toScale=new t.Vec3,this._tempScale=new t.Vec3,this.easing=$t.Linear,this._parameterFlag=!1,this._sv={},this._ev={}}_parseProperties(e){let n;return e instanceof t.Vec2?n={x:e.x,y:e.y}:e instanceof t.Vec3?n={x:e.x,y:e.y,z:e.z}:e instanceof t.Quat?n={x:e.x,y:e.y,z:e.z,w:e.w}:e instanceof t.Color?(n={r:e.r,g:e.g,b:e.b},void 0!==e.a&&(n.a=e.a)):e instanceof Object?n=e:(n=e,this._parameterFlag=!0),n}scale(t,e,n,r,o,i){return this._properties=this._parseProperties(t),this.duration=e,n&&(this.easing=n),r&&this.delay(r),o&&this.repeat(o),i&&this.yoyo(i),this._scale=!0,this}to(t,e,n,r,o,i){return this._properties=this._parseProperties(t),this.duration=e,n&&(this.easing=n),r&&this.delay(r),o&&this.repeat(o),i&&this.yoyo(i),this}from(t,e,n,r,o,i){return this._properties=this._parseProperties(t),this.duration=e,n&&(this.easing=n),r&&this.delay(r),o&&this.repeat(o),i&&this.yoyo(i),this._from=!0,this}rotate(t,e,n,r,o,i){return this._properties=_parseProperties(t),this.duration=e,n&&(this.easing=EASING_TYPE[n]),r&&this.delay(r),o&&this.repeat(o),i&&this.yoyo(i),this._slerp=!0,this}start(){let t,e,n,r;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){if(this._parameterFlag)this._sv=this._properties,this._ev=this.target;else for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),e=void 0!==this._properties.x?this._properties.x:this.target.x,n=void 0!==this._properties.y?this._properties.y:this.target.y,r=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(e,n,r))}else{if(this._parameterFlag)this._sv=this.target,this._ev=this._properties;else for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),e=void 0!==this._properties.x?this._properties.x:this.target.x,n=void 0!==this._properties.y?this._properties.y:this.target.y,r=void 0!==this._properties.z?this._properties.z:this.target.z,this._toQuat.setFromEulerAngles(e,n,r))}return this._currentDelay=this._delay,this.manager.add(this),this}pause(){this.playing=!1}resume(){this.playing=!0}stop(){this.playing=!1,this.stopped=!0}delay(t){return this._delay=t,this.pending=!0,this}repeat(t,e){return this._count=0,this._numRepeats=t,this._repeatDelay=e||0,this}loop(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this}yoyo(t){return this._yoyo=t,this}reverse(){return this._reverse=!this._reverse,this}chain(){let t=arguments.length;for(;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this}update(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}let e=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(e=this.duration-this.time,this.time=0):(e=this.time-this.duration,this.time=this.duration));let n,r,o=this.time/this.duration,i=this.easing(o);this._parameterFlag&&(n=this._sv,r=this._ev,this.component[this.componentType]=n+(r-n)*i);for(let t in this._properties)this._properties.hasOwnProperty(t)&&(n=this._sv[t],r=this._ev[t],this.target[t]=n+(r-n)*i);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,i),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){let t=this._repeat(e);return t?this.fire("loop"):(this.fire("complete",e),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),t}return!0}_repeat(t){if(this._yoyo){for(var e in this._properties){let t=this._sv[e];this._sv[e]=this._ev[e],this._ev[e]=t}return this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat)),this.complete=!1,this.playing=!0,this.time=0,!0}return this._count<this._numRepeats&&(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,!0)}static Linear(t){return t}static QuadraticIn(t){return t*t}static QuadraticOut(t){return t*(2-t)}static QuadraticInOut(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}static CubicIn(t){return t*t*t}static CubicOut(t){return--t*t*t+1}static CubicInOut(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}static QuarticIn(t){return t*t*t*t}static QuarticOut(t){return 1- --t*t*t*t}static QuarticInOut(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}static QuinticIn(t){return t*t*t*t*t}static QuinticOut(t){return--t*t*t*t*t+1}static QuinticInOut(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}static SineIn(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)}static SineOut(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)}static SineInOut(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}static ExponentialIn(t){return 0===t?0:Math.pow(1024,t-1)}static ExponentialOut(t){return 1===t?1:1-Math.pow(2,-10*t)}static ExponentialInOut(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}static CircularIn(t){return 1-Math.sqrt(1-t*t)}static CircularOut(t){return Math.sqrt(1- --t*t)}static CircularInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static ElasticIn(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))}static ElasticOut(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)}static ElasticInOut(t){var e,n=.1,r=.4;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=r*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*.5+1)}static BackIn(t){var e=1.70158;return t*t*((e+1)*t-e)}static BackOut(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}static BackInOut(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}static BounceIn(t){return 1-BounceOut(1-t)}static BounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static BounceInOut(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5}}exports.Loader=class{constructor(t){this._viewer=t,this._app=t.app,this._assets=[],this._size=0,this._progress=0,this._onLoadMethod={"emw-container":this._onModelLoad.bind(this),audio:this._onAudioLoad.bind(this),cubemap:this._onCubemapLoad.bind(this)}}load(){return this._getTotal().then((t=>new Promise(((e,n)=>{let r=this._assets.length,o=[];const i=()=>{r--,r<=0&&e()};for(let e=0;e<this._assets.length;e++){let r=this._assets[e],s=r.getFileUrl();".glb"===s.match(/.\w+$/g)[0]&&r._gz&&(s+=".gz",delete r._gz),Jt.get(s,{onprogress:(n,r)=>{o[e]=n.loaded,console.log(n.loaded);let i=0;o.map((t=>{i+=t})),this._progress=Math.min(1,Math.max(0,i/t)),this._viewer.fire("progress",this._progress)}},((t,e)=>{t?n({error:t,asset:r}):this._onLoadMethod[r.type](r,e).then(i).catch((t=>{n(t)}))}))}}))))}add(t){this._assets.push(t),this._app.assets.add(t)}_getTotal(){return new Promise(((e,n)=>{let r=this._assets.length,o=0;const i=()=>{r--,r<=0&&e(o)};for(let e=0;e<this._assets.length;e++){let n=this._assets[e].getFileUrl();".glb"===n.match(/.\w+$/g)[0]&&n.startsWith("http")?Jt.head(n+".gz",{onreadystatechange:(n,r,i,s)=>{if(s.readyState==t.PlatformManager.polyfill.XMLHttpRequest.HEADERS_RECEIVED&&200==s.status){this._assets[e]._gz=!0;let t=parseInt(s.getResponseHeader("x-oss-meta-total")||0);o+=0==t?parseInt(s.getResponseHeader("Content-Length")):t}}},(()=>{this._assets[e]._gz?i():Jt.head(n,{onreadystatechange:(e,n,r,i)=>{i.readyState==t.PlatformManager.polyfill.XMLHttpRequest.HEADERS_RECEIVED&&(o+=parseInt(i.getResponseHeader("Content-Length")))}},i)})):Jt.head(n,{onreadystatechange:(e,n,r,i)=>{i.readyState==t.PlatformManager.polyfill.XMLHttpRequest.HEADERS_RECEIVED&&(o+=parseInt(i.getResponseHeader("Content-Length")))}},i)}}))}_onModelLoad(e,n){const r=function(t,e,n){if(t.extensions&&t.extensions.EXT_meshopt_compression){const r=t.extensions.EXT_meshopt_compression,o=Gt;o.ready.then((function(){const t=r.byteOffset||0,i=r.byteLength||0,s=r.count,a=r.byteStride,c=new Uint8Array(s*a),u=new Uint8Array(e[r.buffer].buffer,e[r.buffer].byteOffset+t,i);o.decodeGltfBuffer(c,s,a,u,r.mode,r.filter),n(null,c)}))}else n(null,null)},o=function(e,n){const r=e.uri;if(r){const e=new t.Asset(r.filename,"texture",{url:r.url,filename:r.filename});e.on("load",(function(){n(null,e)})),this.app.assets.add(e),this.app.assets.load(e)}else n(null,null)},i=function(e,n){const r=e.uri;if(r){const e=new t.Asset(r.filename,"binary",{url:r.url,filename:r.filename});e.on("load",(function(){n(null,new Uint8Array(e.resource))})),this.app.assets.add(e),this.app.assets.load(e)}else n(null,null)};return new Promise(((s,a)=>{let c=e.getFileUrl();t.GlbParser.parseAsync(t.path.getBasename(c),t.path.extractPath(c),n,this._app.graphicsDevice,this._app.assets,{bufferView:{processAsync:r.bind(this)},image:{processAsync:o.bind(this)},buffer:{processAsync:i.bind(this)}},((n,r)=>{if(n)return console.log("reject",n),void a(n);e.loaded=!0,e.resource=new t.EMWContainerResource(r),this._app.loader.getHandler("emw-container").patch(e,this._app.assets),console.log("resolve"),s()}))}))}_onAudioLoad(e,n){return new Promise(((r,o)=>{e.loaded=!0;console.log(this._app._soundManager),this._app._soundManager.context.decodeAudioData(n,(function(n){let o=new t.Sound(n);e.resource=o,r()}),o)}))}_onCubemapLoad(t,e){return new Promise(((n,r)=>{let o=t.getFileUrl();t.loaded=!0;let i=this._app.loader.getHandler("cubemap-hdr");t.resource=i.open(o,e,t),i.patch(t,this._app.assets),n()}))}},exports.Tween=$t,exports.TweenManager=class{constructor(t){this._app=t,this._tweens=[],this._add=[],this._app.on("update",this.update,this)}add(t){return this._add.push(t),t}update(t){let e=0,n=this._tweens.length;for(;e<n;)this._tweens[e].update(t)?e++:(this._tweens.splice(e,1),n--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}},exports.ViewerAnimation=class{constructor(e,n){this.showAt=this.showAt(),this.viewer=e,t.events.attach(this),this._component=n.getComponent("animation"),this.playing=!1,e.on("update",this._update,this)}get animations(){return this._component.animations}get currAnim(){return this._component.currAnim}get progress(){return this.currentTime/this.duration}get currentTime(){return this._component.currentTime}get duration(){return this._component.duration}get loop(){return this._component.loop}set loop(t){this._component.loop=t}get speed(){return this._component.speed}set speed(t){this._component.speed=t}play(t){this.playing=!0,this._component.play(t)}pause(){this.playing=!1,this._component.pause()}resume(t){this.playing=!0;let e=this._component.currentTime;this._component.resume(t,0),this._component.currentTime=e}showAt(){let t=null;return(e,n,r=0,o)=>{let i=this;t&&t.stop(),e!==this.currAnim?(this._component.play(e),this._component.pause(),this._component.currentTime=0):(this._component.resume(e),this._component.pause()),0!=r?t=this.viewer._tween({time:this._component.currentTime}).to({time:this.duration*n},r,$t.Linear).on("update",(function(t){i._component.currentTime=this.target.time})).on("complete",(()=>{o&&o()})).start():(this._component.currentTime=this.duration*n,o&&o()),this.once("stop",(()=>{t&&t.stop()}))}}stop(){this.playing=!1,this._component.stop(),this.fire("stop")}_update(t){this.loop||this._component.playing&&this.currentTime>=this.duration&&this.playing&&(this.fire("animation:end",this.currAnim),this.fire("animation:end:"+this.currAnim),this.playing=!1)}},exports.WechatPlatform=Qt;
